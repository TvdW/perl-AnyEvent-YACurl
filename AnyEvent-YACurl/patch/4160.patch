From 5a341e33f1e3752936f3b08ab6774ac12a20e7e1 Mon Sep 17 00:00:00 2001
From: Daniel Stenberg <daniel@haxx.se>
Date: Mon, 29 Jul 2019 11:15:33 +0200
Subject: [PATCH] http2_recv: trigger another read when the last data is
 returned

... so that end-of-stream is detected properly.

Reported-by: Tom van der Woerdt
Fixes #4043
---
 lib/http2.c | 3 +++
 1 file changed, 3 insertions(+)

diff --git a/curl-src/lib/http2.c b/curl-src/lib/http2.c
index eb55e62d1c..7112635249 100644
--- a/curl-src/lib/http2.c
+++ b/curl-src/lib/http2.c
@@ -1755,6 +1755,9 @@ static ssize_t http2_recv(struct connectdata *conn, int sockindex,
     else if(!stream->closed) {
       drained_transfer(data, httpc);
     }
+    else
+      /* this stream is closed, trigger a another read ASAP to detect that */
+      Curl_expire(data, 0, EXPIRE_RUN_NOW);
 
     return retlen;
   }
